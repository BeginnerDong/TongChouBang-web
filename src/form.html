<div id="form_app">
	<div class="active_big_k act_big_0" id="act_big" style="z-index:999;right: 0.8%;">
		<div>
			<h2 class="active_title">活动需求</h2>
			<ul>
				<li class="clear active_tab" style="">
					<div class="act_t_1">活动类型</div>
					<select class="select_t_1" @change="changeType">
						<option>不限</option>
						<option v-for="item in labelData">{{item.title}}</option>
	
					</select>
				</li>
				<li class="clear active_tab" style="">
					<div class="act_t_1">活动时间</div>
					<input class="activ_Input" type="date" name="user_date" style="height:20px;border:none" v-model="submitData.description" />
				</li>
				<li class="clear active_tab">
					<div class="act_t_1">预算</div>
					<div class="act_t_2"><input class="act_i_1" type="number" placeholder="请输入您的预算值" v-model="submitData.keywords" /></div>
				</li>
				<li class="clear active_tab">
					<div class="act_t_1">联系人姓名</div>
					<div class="act_t_2"><input class="act_i_1" placeholder="请输入联系人姓名" v-model="submitData.passage1" /></div>
				</li>
				<li class="clear active_tab">
					<div class="act_t_1">联系电话</div>
					<div class="act_t_2"><input type="number" class="act_i_1" placeholder="请输入11位手机号码" v-model="submitData.phone" /></div>
				</li>
				<li class="clear active_tab">
					<div class="act_t_1">短信验证</div>
					<div class="act_t_2"><input class="act_i_2" placeholder="" type="number" v-model="smsCode"  onkeyup="this.value=this.value.replace(/\D/g,'')" /><a class="sendyzm" :style="hasSend?'text-decoration:none':''" @click="sendCode">{{hasSend?'已发送':'短信验证'}}</a>
					</div>
				</li>
				<li class="clear active_tab">
					<div class="act_t_1" style="width: 20%;">备注</div>
					<div class="act_t_2" style="width: 80%;"><textarea style="border: none;resize: none" v-model="submitData.content"></textarea></div>
				</li>
			</ul>
			<p class="act_plan">
				<span style="font-size: 16px;">不想自己找吗？</span>把你们的计划要求告诉我们，统筹帮免费帮你推荐最合适的需求，帮你做活动统筹计划
			</p>
			<p class="act_tel">咨询热线：13126608897</span></p>
			<button class="act_btn" @click="submit">提交需求</button>
		</div>
	</div>
</div>


<script type="text/javascript">
	var app = new Vue({
		el: '#form_app',
		data() {
			return {

				submitData: {
					phone: '',
					passage1: '',
					title: '',
					description: '',
					content: '',
					keywords: '',
					type: 1,
					user_type:0
				},
				smsCode:'',
				labelData: [],
				searchItem: {
					status: 1
				},
				hasSend:false

			}
		},
		created() {
			const self = this;
			console.log('form',11)
			self.getLabelData();
		},

		methods: {

			sendCode:function(){
				var self = this;
				
				if(self.hasSend){
					return;
				};
				var phone = self.submitData.phone;
				
				if (phone.trim().length != 11 || !/^1[3|4|5|6|7|8|9]\d{9}$/.test(phone)) {
					
					alert('请输入正确的手机号码');
					return;
				}
				var postData = {
					params:{
						PhoneNumbers:self.submitData.phone
					}
				};
				var callback = function(res){
					if(res.solely_code==100000){
						self.hasSend = true;
					}else{
						alert('发送失败');
					};
				};
				window.base.sendCode(postData, callback);
			},

			changeType(e) {
				const self = this;
				console.log(e)
				self.submitData.title = self.labelData[e.target.options.selectedIndex - 1].title
			},

			messageAdd() {
				const self = this;
				const postData = {};
				postData.data = {};
				postData.data = window.base.cloneForm(self.submitData);
				postData.smsAuth = {
					phone:self.submitData.phone,
					code:self.smsCode
				};
				const callback = (res) => {
					if (res.solely_code == 100000) {
						alert('提交成功');
						//window.location.reload()
					} else {
						alert(res.msg)
					}

				};
				window.base.addMessage(postData, callback);
			},





			submit() {
				const self = this;

				console.log(self.submitData)

				var newObject = window.base.cloneForm(self.submitData);
				delete newObject.content;
				const pass = window.base.checkComplete(newObject);
				console.log('pass', pass)
				if (pass) {

					self.messageAdd();
				} else {
					alert('请补全信息');
				};
			},

			getLabelData(id) {
				var self = this;
				var postData = {};

				postData.searchItem = window.base.cloneForm(self.searchItem);
				postData.getBefore = {
					Label: {
						tableName: 'Label',
						middleKey: 'parentid',
						key: 'id',
						searchItem: {
							title: ['in', ['精选案例']]
						},
						condition: 'in'
					}
				};
				postData.order = {
					listorder: 'desc'
				};
				var callback = function(res) {
					if (res.info.data.length > 0) {
						self.labelData.push.apply(self.labelData, res.info.data);
					}
					console.log('self.labelData', self.labelData)
				};

				window.base.labelGet(postData, callback);
			},

		}
	});
</script>

<style type="text/css">
	.active_big_k .act_btn{ width: 90%;margin:20px auto;display: block;}
</style>

